# Reference

https://www.gnu.org/software/make/manual/make.html  
https://www.coursera.org/learn/writing-running-fixing-code/supplement/kTFif/fancier-make-options


## version 1
```makefile
CC = gcc                             # the C-compiler, here we define one or more variables to store the compiler options
CFLAGS = -std=gnu99 -pedantic -Wall  # flags for the C-compiler
CPPFLAGS = ...                       # flags for the C++-compiler

executable.exe: file1.o file2.o            # target: dependencies (this is a specific rule)
    gcc -o executable.exe file1.o file2.o  # TAB + the command to (re)build the target
file1.o: file1.c class1.h class2.h         # another specific rule, list rules from the top target to the bottom
    gcc $(CFLAGS) -c file1.c               # $(CFLAGS) extracts the value of CFLAGS
file2.o: file2.c class3.h class4.h
    gcc $(CFLAGS) -c file2.c

.PHONY: clean  # list phony targets (targets that won't be created into files)
clean:         # a special target intended to remove cluttery files to clean up the directory
    rm -f executable.exe *.o *.c~ *.h~  # rm the compiled program, all object files, all editor backups (*.c~ *.h~), and more
```

## version 2
```makefile
CC = gcc
CFLAGS = -std=gnu99 -pedantic -Wall
CPPFLAGS = ...

executable.exe: file1.o file2.o
    gcc -o executable.exe file1.o file2.o

%.o: %.c                 # a generic rule which automatically builds xxx.o from xxx.c
    gcc $(CFLAGS) -c $<  # $< is a special built-in variable which will be replaced by the current %.c at runtime

.PHONY: clean
clean:
    rm -f executable.exe *.o *.c~ *.h~

file1.o: class1.h class2.h  # provide additional dependence information for %.o: %.c by hand (tedious and error-prone)
file2.o: class3.h class4.h  # this is necessary because %.o also depends on some header files
```

## version 3
```makefile
CC = gcc
CFLAGS = -std=gnu99 -pedantic -Wall
CPPFLAGS = ...

executable.exe: file1.o file2.o
    gcc -o executable.exe file1.o file2.o

.PHONY: clean depend  # add another phony target called depend
clean:
    rm -f executable.exe *.o *.c~ *.h~
depend:                         # a special built-in generic rule intended to call makedepend
    makedepend file1.c file2.c  # makedepend + all source files (xxx.c)
                                # this will automatically figure out additional dependency information
                                # with depend, no longer need to explicitly write the %.o: %.c generic rule

# DO NOT DELETE  # this comment and the next 2 lines are generated by makedepend itself
file1.o: class1.h class2.h
file2.o: class3.h class4.h
```

## version 4
```makefile
CC = gcc
CFLAGS = -std=gnu99 -pedantic -Wall
CPPFLAGS = ...

# add 2 variables to store the names of all .c files and .o files
# the syntax to call makeâ€™s built-in functions: $(functionName arg1, arg2, arg3)
SRCS = $(wildcard *.c)                # $(wildcard pattern)
                                      # returns the list of .c files in the current directory
OBJS = $(patsubst %.c, %.o, $(SRCS))  # $(patsubst pattern, replacement, text)
                                      # replace the .c endings with .o endings

executable.exe: $(OBJS)
    gcc -o $@ $(OBJS)  # $@ is a special built-in variable which will be replaced by the current target at runtime

.PHONY: clean depend
clean:
    rm -f executable.exe *.o *.c~ *.h~
depend:
    makedepend $(SRCS)  # now we don't need to write all source files (xxx.c) by hand
                        # now we could use this Makefile on a large-scale project
# DO NOT DELETE
file1.o: class1.h class2.h
file2.o: class3.h class4.h
```

## version 5
```makefile
BIN = bin
SRC = src
OBJ = build
INC = include

TARGET = sshell

CXXFLAGS = -g -Wall -pedantic -I$(INC)

SRCS = $(wildcard $(SRC)/*.cpp)
OBJS = $(patsubst $(SRC)/%.cpp, $(OBJ)/%.o, $(SRCS))

$(BIN)/$(TARGET): $(OBJS)
    @echo "linking..."
    $(CXX) $(CXXFLAGS) -o $@ $^
    @echo "done!"

$(OBJ)/%.o: $(SRC)/%.cpp
    @echo "compiling..."
    $(CXX) $(CXXFLAGS) -o $@ -c $<

.PHONY: clean

clean:
    @echo "cleaning..."
    rm -f $(BIN)/$(TARGET) $(OBJS)
```

## make
```shell
make depend         # update dependency information
make                # compile and link to generate our executable.exe
make clean          # clean up the current directory
make clean && make  # recompile after modification
```

## make README with shell
```makefile
# [target]: [dependencies...]
# 	[commands...]
# NOTE: MUST use tab before commands, no spaces allowed

README.md: shell_script.sh
    echo "# Make a title on the 1st line" > README.md
    echo "Author: neo-mashiro" >> README.md
    echo "Created on: 2018/01/31" >> README.md
    echo "---" >> README.md  # add a horizontal rule
    echo "Lines of code in shell_script.sh: " >> README.md
    wc -l shell_script.sh >> README.md
```
